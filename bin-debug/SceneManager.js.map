{"version":3,"file":"SceneManager.js","sourceRoot":"","sources":["../src/SceneManager.ts"],"names":[],"mappings":"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","sourcesContent":["class SceneManager {\r\n    public static STAGE_ONE_WIDTH: number = 512;\r\n\r\n    public static loader: ResourceLoader;\r\n    public static mainScene: Main;\r\n    public static tick: number = 0;\r\n\r\n    public awlPosX: number = 1024;\r\n    private maxPosX: number = 512;\r\n\r\n    public constructor(main) {\r\n        SceneManager.mainScene = main;\r\n        this.createLoader();\r\n    }\r\n\r\n    public onStart() {\r\n        this.createInitScene().then(() => {\r\n            this.createScene();\r\n            this.update();\r\n        });\r\n    }\r\n\r\n    private createLoader() {\r\n        if (!SceneManager.loader) SceneManager.loader = new ResourceLoader();\r\n    }\r\n\r\n    private async createInitScene() {\r\n        return await SceneManager.loader.loadMainResource([\"preload\"], \"resource/default.res.json\");\r\n    }\r\n\r\n    private createScene() {\r\n        SceneManager.mainScene.bg = new Background();\r\n        SceneManager.mainScene.addChild(SceneManager.mainScene.bg);\r\n\r\n        SceneManager.mainScene.floor = new Floor();\r\n        SceneManager.mainScene.addChild(SceneManager.mainScene.floor);\r\n\r\n        SceneManager.mainScene.character = new Runner();\r\n        SceneManager.mainScene.addChild(SceneManager.mainScene.character);\r\n\r\n        SceneManager.mainScene.awls = new Array<Awl>();\r\n    }\r\n\r\n    // 최솟값 포함, 최댓값 제외\r\n    private createRandomAwls(min, max) {\r\n        const rand = Math.floor(Math.random() * (max - min)) + min;\r\n        const newAwl = new Awl(rand);\r\n        SceneManager.mainScene.awls.push(newAwl);\r\n        SceneManager.mainScene.addChild(newAwl);\r\n        return rand;\r\n    }\r\n\r\n    public update() {\r\n        egret.startTick(this.updateTick, this);\r\n    }\r\n\r\n    private updateTick() {\r\n        if (SceneManager.tick > 900 && Runner.STATE != RUNNER_STATE.DIE) {\r\n            egret.stopTick(this.updateTick, this);\r\n            this.setClear();\r\n        }\r\n        SceneManager.tick += 1;\r\n\r\n        if (SceneManager.tick % 90 == 0) {\r\n            this.awlPosX = this.createRandomAwls(this.awlPosX, this.awlPosX + this.maxPosX);\r\n        }\r\n\r\n        SceneManager.mainScene.bg.update();\r\n        SceneManager.mainScene.floor.update();\r\n\r\n        if (SceneManager.mainScene.awls.length > 0) {\r\n            SceneManager.mainScene.awls.forEach((awl) =>\r\n                awl.update()\r\n            );\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private setClear() {\r\n        const image = new egret.Bitmap();\r\n        image.texture = RES.getRes(\"asset_clear_png\");\r\n\r\n        image.x = 256;\r\n        SceneManager.mainScene.addChild(image);\r\n        SceneManager.mainScene.character.stop();\r\n        SceneManager.mainScene.awls.forEach((awl) =>\r\n            awl.destroy()\r\n        );\r\n    }\r\n}"]}